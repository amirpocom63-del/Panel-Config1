<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Panel MrVpn</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Arial;
  background: radial-gradient(circle at 20% 20%, #1e293b, #0f172a 60%);
  color:white;
}
.header{
  padding:30px 40px;
  font-size:28px;
  font-weight:600;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,0.1);
}
.container{
  padding:40px;
}
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
  gap:25px;
  margin-bottom:40px;
}
.card{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:20px;
  padding:30px;
  backdrop-filter:blur(15px);
  transition:0.3s;
}
.card:hover{
  transform:translateY(-5px);
  box-shadow:0 20px 50px rgba(0,0,0,0.4);
}
.card h2{
  font-size:40px;
  margin:0;
}
.section{
  margin-top:40px;
}
canvas{
  background:rgba(255,255,255,0.05);
  border-radius:20px;
  padding:20px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  background:rgba(255,255,255,0.05);
  border-radius:20px;
  overflow:hidden;
}
th,td{
  padding:15px;
  text-align:left;
}
th{
  background:rgba(255,255,255,0.08);
  cursor:pointer;
}
tr:nth-child(even){
  background:rgba(255,255,255,0.03);
}
.badge{
  padding:5px 10px;
  border-radius:10px;
  font-size:12px;
}
.healthy{background:#16a34a}
.slow{background:#facc15;color:black}
.down{background:#dc2626}

/* Login Screen */
#loginScreen{
position:fixed;
inset:0;
background:linear-gradient(135deg,#0f172a,#1e293b);
display:flex;
align-items:center;
justify-content:center;
z-index:9999;
}
.loginBox{
background:rgba(255,255,255,0.05);
backdrop-filter:blur(20px);
padding:40px;
border-radius:20px;
width:300px;
text-align:center;
}
.loginBox input{
width:100%;
padding:12px;
margin:20px 0;
border-radius:10px;
border:none;
}
.loginBox button{
width:100%;
padding:12px;
border-radius:10px;
border:none;
background:#3b82f6;
color:white;
cursor:pointer;
}
#errorMsg{
color:#dc2626;
display:none;
}
</style>
</head>
<body>

<!-- Login -->
<div id="loginScreen">
  <div class="loginBox">
    <h2>ğŸ” Panel MrVpn</h2>
    <input type="password" id="passwordInput" placeholder="Enter password">
    <button onclick="login()">Login</button>
    <p id="errorMsg">Wrong password</p>
  </div>
</div>

<div class="header">ğŸš€ Panel MrVpn</div>

<div class="container">

<div class="grid">
  <div class="card">
    <h2 id="healthy">0</h2>
    <span>ğŸŸ¢ Healthy</span>
  </div>
  <div class="card">
    <h2 id="slow">0</h2>
    <span>ğŸŸ¡ Slow</span>
  </div>
  <div class="card">
    <h2 id="down">0</h2>
    <span>ğŸ”´ Down</span>
  </div>
</div>

<div class="section">
  <canvas id="speedChart"></canvas>
</div>

<div class="section">
  <canvas id="statusChart"></canvas>
</div>

<div class="section">
  <h2>Server List</h2>
  <table id="serverTable">
    <thead>
      <tr>
        <th>Server</th>
        <th>Latency</th>
        <th>Speed</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

</div>

<script>
const CORRECT_PASSWORD = "Amir1388*";

function login(){
  const input = document.getElementById("passwordInput").value;
  if(input === CORRECT_PASSWORD){
    sessionStorage.setItem("auth","true");
    document.getElementById("loginScreen").style.display="none";
  } else {
    document.getElementById("errorMsg").style.display="block";
  }
}

if(sessionStorage.getItem("auth")==="true"){
  document.getElementById("loginScreen").style.display="none";
}

fetch("report.json")
.then(r=>r.json())
.then(data=>{
  let healthy=0, slow=0, down=0;

  data.results.forEach(s=>{
    if(s.status==="healthy") healthy++;
    if(s.status==="slow") slow++;
    if(s.status==="down") down++;
  });

  document.getElementById("healthy").innerText=healthy;
  document.getElementById("slow").innerText=slow;
  document.getElementById("down").innerText=down;

  new Chart(document.getElementById("speedChart"),{
    type:"bar",
    data:{
      labels:data.results.map(r=>r.url),
      datasets:[{
        label:"Speed (Mbps)",
        data:data.results.map(r=>r.speedMbps),
        backgroundColor:"#3b82f6"
      }]
    }
  });

  new Chart(document.getElementById("statusChart"),{
    type:"doughnut",
    data:{
      labels:["Healthy","Slow","Down"],
      datasets:[{
        data:[healthy,slow,down],
        backgroundColor:["#16a34a","#facc15","#dc2626"]
      }]
    }
  });

  let tbody=document.querySelector("#serverTable tbody");
  data.results.forEach(r=>{
    let row=document.createElement("tr");
    row.innerHTML=`
      <td>${r.url}</td>
      <td>${r.latency} ms</td>
      <td>${r.speedMbps} Mbps</td>
      <td><span class="badge ${r.status}">${r.status}</span></td>
    `;
    tbody.appendChild(row);
  });
});
</script>

</body>
</html>    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{margin:0; font-size:22px; letter-spacing:.2px}
    .sub{color:var(--muted); font-size:13px; line-height:1.6}
    .pillbar{display:flex; gap:8px; flex-wrap:wrap}
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:8px 10px; border-radius:999px; font-size:12px; color:var(--muted);
      display:flex; gap:8px; align-items:center;
    }
    .dot{width:8px; height:8px; border-radius:999px; background:var(--warn)}
    .dot.ok{background:var(--ok)}
    .dot.bad{background:var(--bad)}
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      backdrop-filter: blur(8px);
    }
    .card h2{
      margin:0 0 10px 0; font-size:14px; color:var(--muted); font-weight:600;
      display:flex; justify-content:space-between; align-items:center;
    }
    .btnrow{display:flex; gap:10px; flex-wrap:wrap}
    a.btn, button.btn{
      appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.03);
      color:var(--text); text-decoration:none; padding:10px 12px; border-radius:14px;
      font-size:13px; display:inline-flex; gap:8px; align-items:center;
      cursor:pointer; transition: transform .06s ease, background .12s ease;
    }
    a.btn:hover, button.btn:hover{background:rgba(255,255,255,.06)}
    a.btn:active, button.btn:active{transform:translateY(1px)}
    .btn.primary{border-color:rgba(124,92,255,.45); background:rgba(124,92,255,.14)}
    .btn.primary:hover{background:rgba(124,92,255,.20)}
    .btn.ok{border-color:rgba(32,201,151,.45); background:rgba(32,201,151,.10)}
    .btn.ok:hover{background:rgba(32,201,151,.14)}
    .btn.bad{border-color:rgba(255,107,107,.45); background:rgba(255,107,107,.10)}
    .btn.bad:hover{background:rgba(255,107,107,.14)}
    .meta{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px;
    }
    @media (max-width: 520px){ .meta{grid-template-columns:1fr} }
    .kv{
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      border-radius:14px;
      padding:10px 12px;
    }
    .kv .k{color:var(--muted); font-size:12px}
    .kv .v{font-family:var(--mono); font-size:13px; margin-top:6px; word-break:break-all}
    pre{
      margin:0; padding:12px; border-radius:14px; border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      overflow:auto; max-height:360px;
      font-family:var(--mono); font-size:12.5px; line-height:1.55;
      white-space:pre-wrap; word-break:break-word;
    }
    footer{margin-top:16px; color:var(--muted); font-size:12px}
    .toast{
      position:fixed; inset:auto 14px 14px auto;
      background:rgba(0,0,0,.72); color:#fff; padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      font-size:12px; opacity:0; transform: translateY(6px);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
    }
    .toast.show{opacity:1; transform: translateY(0)}
    .small{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Company Feed Dashboard</h1>
        <div class="sub">
          Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ GitHub Actions Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´Ù† Ùˆ Ø§ÛŒÙ† ØµÙØ­Ù‡ ÙÙ‚Ø· Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø±Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡.
          <span class="small"> (merged.txt / report.json / last_updated.txt)</span>
        </div>
      </div>

      <div class="pillbar">
        <div class="pill" id="pillStatus"><span class="dot" id="dot"></span><span id="statusText">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒâ€¦</span></div>
        <div class="pill">Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª: <span id="lastUpdated">â€”</span></div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>
          Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
          <span class="small" id="baseUrl"></span>
        </h2>

        <div class="btnrow">
          <a class="btn primary" href="./merged.txt" id="linkMerged">ğŸ“„ merged.txt</a>
          <a class="btn" href="./report.json" id="linkReport">ğŸ§¾ report.json</a>
          <a class="btn" href="./last_updated.txt" id="linkUpdated">ğŸ•’ last_updated.txt</a>
          <button class="btn ok" id="copyMerged">ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© merged.txt</button>
          <button class="btn" id="copyAll">ğŸ“‹ Ú©Ù¾ÛŒ Ù‡Ù…Ù‡ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§</button>
        </div>

        <div class="meta">
          <div class="kv">
            <div class="k">OK sources</div>
            <div class="v" id="okCount">â€”</div>
          </div>
          <div class="kv">
            <div class="k">Failed sources</div>
            <div class="v" id="badCount">â€”</div>
          </div>
          <div class="kv">
            <div class="k">Total lines (reported)</div>
            <div class="v" id="totalLines">â€”</div>
          </div>
          <div class="kv">
            <div class="k">Health</div>
            <div class="v" id="healthText">â€”</div>
          </div>
        </div>

        <footer>
          Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ø´Ù‡ØŒ Ø¨Ù‡ØªØ±Ù‡ Pages Ø±Ùˆ Public Ù†Ø°Ø§Ø±ÛŒ ÛŒØ§ Ø®Ø±ÙˆØ¬ÛŒ Ø±Ùˆ Ø¯Ø± ÛŒÚ© Ù…Ø­Ù„ Ø¯Ø§Ø®Ù„ÛŒ Ø³Ø±Ùˆ Ú©Ù†ÛŒØ¯.
        </footer>
      </section>

      <section class="card">
        <h2>
          Ø®Ù„Ø§ØµÙ‡ Ú¯Ø²Ø§Ø±Ø´
          <button class="btn" id="refresh">ğŸ”„ Ø±ÙØ±Ø´</button>
        </h2>
        <pre id="reportPreview">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ report.json â€¦</pre>
      </section>
    </div>

    <section class="card" style="margin-top:14px">
      <h2>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ merged.txt <span class="small">(ÙÙ‚Ø· Ø¨Ø®Ø´ Ø§ÙˆÙ„)</span></h2>
      <pre id="mergedPreview">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ merged.txt â€¦</pre>
    </section>
  </div>

  <div class="toast" id="toast">Ú©Ù¾ÛŒ Ø´Ø¯</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const dot = $("dot");
  const statusText = $("statusText");
  const lastUpdated = $("lastUpdated");
  const baseUrl = $("baseUrl");

  const okCount = $("okCount");
  const badCount = $("badCount");
  const totalLines = $("totalLines");
  const healthText = $("healthText");

  const reportPreview = $("reportPreview");
  const mergedPreview = $("mergedPreview");

  const toast = $("toast");
  const showToast = (t) => {
    toast.textContent = t;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1200);
  };

  const abs = (path) => new URL(path, location.href).toString();
  baseUrl.textContent = location.origin + location.pathname.replace(/\/[^\/]*$/, "/");

  async function copyText(text) {
    try {
      await navigator.clipboard.writeText(text);
      showToast("Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
    } catch {
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      showToast("Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
    }
  }

  $("copyMerged").onclick = () => copyText(abs("./merged.txt"));
  $("copyAll").onclick = () => {
    const list =
      `merged.txt: ${abs("./merged.txt")}\n` +
      `report.json: ${abs("./report.json")}\n` +
      `last_updated.txt: ${abs("./last_updated.txt")}\n`;
    copyText(list);
  };
  $("refresh").onclick = () => loadAll(true);

  function setStatus(kind, text) {
    statusText.textContent = text;
    dot.className = "dot" + (kind ? " " + kind : "");
    $("pillStatus").style.borderColor =
      kind === "ok" ? "rgba(32,201,151,.45)" :
      kind === "bad" ? "rgba(255,107,107,.45)" :
      "rgba(255,255,255,.10)";
  }

  async function safeFetchText(url, maxChars = 6000) {
    const r = await fetch(url, { cache: "no-store" });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const t = await r.text();
    return t.length > maxChars ? (t.slice(0, maxChars) + "\nâ€¦(truncated)") : t;
  }

  async function loadAll(force) {
    setStatus("", "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒâ€¦");
    healthText.textContent = "â€”";
    okCount.textContent = "â€”";
    badCount.textContent = "â€”";
    totalLines.textContent = "â€”";

    // last_updated.txt
    try {
      const t = await safeFetchText("./last_updated.txt", 200);
      lastUpdated.textContent = t.trim() || "â€”";
    } catch {
      lastUpdated.textContent = "â€”";
    }

    // report.json
    let reportObj = null;
    try {
      const r = await fetch("./report.json", { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      reportObj = await r.json();

      const ok = Array.isArray(reportObj.ok) ? reportObj.ok.length : 0;
      const bad = Array.isArray(reportObj.bad) ? reportObj.bad.length : 0;
      const tl = typeof reportObj.total_lines === "number" ? reportObj.total_lines : "â€”";

      okCount.textContent = String(ok);
      badCount.textContent = String(bad);
      totalLines.textContent = String(tl);

      reportPreview.textContent = JSON.stringify(reportObj, null, 2);

      // Health label
      if (bad === 0 && ok > 0) {
        setStatus("ok", "Ù‡Ù…Ù‡ Ú†ÛŒØ² OK");
        healthText.textContent = "OK âœ…";
      } else if (ok === 0) {
        setStatus("bad", "Ù‡ÛŒÚ† Ù…Ù†Ø¨Ø¹ Ø³Ø§Ù„Ù…ÛŒ Ù†ÛŒØ³Øª");
        healthText.textContent = "BAD âŒ";
      } else {
        setStatus("bad", "Ø¨Ø¹Ø¶ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ø®Ø·Ø§ Ø¯Ø§Ø±Ù†Ø¯");
        healthText.textContent = "PARTIAL âš ï¸";
      }
    } catch (e) {
      reportPreview.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† report.json:\n${e?.message || e}`;
      setStatus("bad", "Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª");
      healthText.textContent = "UNKNOWN";
    }

    // merged.txt preview
    try {
      const t = await safeFetchText("./merged.txt", 12000);
      mergedPreview.textContent = t;
    } catch (e) {
      mergedPreview.textContent = `Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† merged.txt:\n${e?.message || e}`;
    }
  }

  loadAll(false);
})();
</script>
</body>
  </html>
